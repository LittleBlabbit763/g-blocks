<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>G-Blocks | Imagine, Program, Share</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.min.js"></script>
    <style>
        :root { --g-blue: #4c97ff; --bg: #1e1e1e; --panel: #2d2d2d; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: white; overflow: hidden; }
        .nav { background: var(--g-blue); height: 50px; display: flex; align-items: center; padding: 0 20px; gap: 15px; position: relative; z-index: 100; }
        .nav-btn { cursor: pointer; font-weight: bold; padding: 10px; font-size: 14px; }
        .auth-zone { margin-left: auto; display: flex; align-items: center; gap: 10px; }
        
        /* EDITOR LAYOUT */
        .view { display: none; height: calc(100vh - 50px); width: 100%; }
        .view.active { display: flex; }
        #blocklyDiv { flex: 1; height: 100%; }
        .stage-area { width: 480px; background: #252525; border-left: 2px solid #333; padding: 10px; position: relative; display: flex; flex-direction: column; }
        #stage { width: 460px; height: 345px; background: white; border-radius: 4px; }

        /* HOVER BACKPACK */
        .backpack {
            position: absolute; bottom: 0; left: 10px; right: 10px;
            background: #333; height: 45px; border-radius: 10px 10px 0 0;
            transition: 0.3s ease; border: 1px solid #444; cursor: pointer; overflow: hidden;
        }
        .backpack:hover { height: 160px; background: #3d3d3d; }
        .bp-header { padding: 12px; text-align: center; font-weight: bold; font-size: 13px; border-bottom: 1px solid #444; }
        .bp-content { padding: 20px; text-align: center; color: #888; font-size: 12px; }

        /* LOGIN MODAL */
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        #loginModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      background: white; padding: 30px; border-radius: 12px; width: 320px; z-index: 1001; text-align: center; color: #333; }
        input { width: 90%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-btn" onclick="setView('home')">G-BLOCKS</div>
    <div class="nav-btn" onclick="setView('editor')">Create</div>
    <div class="nav-btn" onclick="setView('explore')">Explore</div>
    <div class="auth-zone">
        <span id="userName">Guest</span>
        <button onclick="showLogin()" style="background:white; border:none; padding:5px 15px; border-radius:4px; cursor:pointer;">Sign In</button>
    </div>
</div>

<div id="modalOverlay" onclick="closeLogin()"></div>
<div id="loginModal">
    <h2 style="margin-top:0">Sign in</h2>
    <input type="text" placeholder="Username">
    <input type="password" placeholder="Password">
    <button style="width:100%; background:var(--g-blue); color:white; border:none; padding:10px; border-radius:4px; font-weight:bold;">Login</button>
    <p style="color:#777; font-size:12px; margin:15px 0;">OR</p>

    <div id="g_id_onload"
         data-client_id="258808178099-fm3pc7dvf10t599fafeo3bnq9qgj6v28.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"></div>
</div>

<div id="editor" class="view active">
    <div id="blocklyDiv"></div>
    <div class="stage-area">
        <div id="stage"></div>
        <div class="backpack">
            <div class="bp-header">Backpack</div>
            <div class="bp-content">Drag code here to save it!</div>
        </div>
    </div>
</div>

<div id="home" class="view" style="padding:40px;"><h1>Welcome to G-Blocks!</h1></div>
<div id="explore" class="view" style="padding:40px;"><h1>Explore Community Projects</h1></div>

<script>
    // VIEW CONTROLLER
    function setView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const active = document.getElementById(id);
        active.classList.add('active');
        if(id === 'editor') setTimeout(() => Blockly.svgResize(ws), 50);
    }

    // AUTH
    function showLogin() { document.getElementById('loginModal').style.display='block'; document.getElementById('modalOverlay').style.display='block'; }
    function closeLogin() { document.getElementById('loginModal').style.display='none'; document.getElementById('modalOverlay').style.display='none'; }
    
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        document.getElementById('userName').innerText = payload.given_name;
        closeLogin();
    }

    // BLOCKLY SETUP (Restoring your image categories)
    const toolbox = {
        "kind": "categoryToolbox",
        "contents": [
            {"kind":"category", "name":"Events", "colour":"#FFD500", "contents":[{"kind":"block","type":"event_whenflagclicked"}]},
            {"kind":"category", "name":"Motion", "colour":"#4C97FF", "contents":[{"kind":"block","type":"motion_movesteps"}]},
            {"kind":"category", "name":"Control", "colour":"#FFAB19", "contents":[{"kind":"block","type":"controls_repeat"}]},
            {"kind":"category", "name":"Sensing", "colour":"#4CBFE6", "contents":[]},
            {"kind":"category", "name":"Variables", "colour":"#FF8C1A", "contents":[]},
            {"kind":"category", "name":"Logic", "colour":"#59C059", "contents":[{"kind":"block","type":"logic_compare"}]},
            {"kind":"category", "name":"Math", "colour":"#40BF4A", "contents":[{"kind":"block","type":"math_number"}]}
        ]
    };

    // Custom Blocks for Scratch Look
    Blockly.Blocks['event_whenflagclicked'] = { init: function() { this.appendDummyInput().appendField("when flag clicked"); this.setNextStatement(true); this.setColour("#FFD500"); } };
    Blockly.Blocks['motion_movesteps'] = { init: function() { this.appendDummyInput().appendField("move").appendField(new Blockly.FieldTextInput("10"), "STEPS").appendField("steps"); this.setPreviousStatement(true); this.setNextStatement(true); this.setColour("#4C97FF"); } };

    const ws = Blockly.inject('blocklyDiv', {
        toolbox: toolbox,
        theme: Blockly.Themes.Zelos,
        grid: {spacing: 20, length: 3, colour: '#333', snap: true}
    });
</script>
</body>
</html>
