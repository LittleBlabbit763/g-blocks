<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Blocks - Imagine, Program, Share</title>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.min.js"></script>
    
    <style>
        :root { --g-blue: #4c97ff; --g-dark: #1e1e1e; --g-panel: #2d2d2d; }
        body { margin: 0; font-family: "Helvetica Neue", Arial, sans-serif; background: var(--g-dark); color: white; overflow-x: hidden; }
        
        /* NAVIGATION */
        .nav { background: var(--g-blue); height: 50px; display: flex; align-items: center; padding: 0 40px; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-btn { cursor: pointer; font-weight: bold; font-size: 14px; padding: 15px 10px; }
        .nav-btn:hover { background: rgba(0,0,0,0.1); }
        .auth-zone { margin-left: auto; display: flex; align-items: center; gap: 15px; }

        /* VIEWS */
        .view { display: none; padding: 20px 40px; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; }

        /* MODAL SYSTEM */
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; }
        #loginModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      background: white; padding: 30px; border-radius: 12px; z-index: 1000; width: 340px; text-align: center; color: #333; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .login-input { width: 90%; padding: 10px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .login-submit { width: 95%; background: var(--g-blue); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }

        /* EDITOR */
        #editor { height: calc(100vh - 50px); max-width: 100%; padding: 0; display: none; }
        #editor.active { display: flex; }
        #blocklyDiv { flex: 1; height: 100%; }
        .stage-area { width: 480px; background: #252525; padding: 10px; border-left: 1px solid #444; }
        #stage { width: 460px; height: 345px; background: white; border-radius: 4px; }

        /* CONTENT GRIDS */
        .section-box { background: var(--g-panel); padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #444; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .card { background: #3d3d3d; border-radius: 6px; overflow: hidden; border: 1px solid #555; }
        .thumb { height: 100px; background: #222; display: flex; align-items: center; justify-content: center; color: #444; font-size: 11px; }
        .info { padding: 8px; font-size: 12px; color: var(--g-blue); font-weight: bold; }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-btn" style="font-size: 18px;" onclick="setView('home')">G-BLOCKS</div>
    <div class="nav-btn" onclick="setView('editor')">Create</div>
    <div class="nav-btn" onclick="setView('explore')">Explore</div>
    <div class="nav-btn" onclick="setView('ideas')">Ideas</div>
    <div class="auth-zone">
        <span id="userName" style="font-size: 13px;">Guest</span>
        <button onclick="showLogin()" style="background:white; color:var(--g-blue); border:none; padding:6px 16px; border-radius:4px; font-weight:bold; cursor:pointer;">Sign In</button>
    </div>
</div>

<div id="modalOverlay" onclick="closeLogin()"></div>
<div id="loginModal">
    <h2 style="margin-top:0">Sign in to G-Blocks</h2>
    <input type="text" class="login-input" placeholder="Username">
    <input type="password" class="login-input" placeholder="Password">
    <button class="login-submit">Login</button>
    
    <div style="margin: 20px 0; color: #777; font-size: 13px; font-weight: bold;">OR</div>

    <div id="g_id_onload"
         data-client_id="258808178099-fm3pc7dvf10.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div style="display: flex; justify-content: center;">
        <div class="g_id_signin" 
             data-type="standard" 
             data-shape="rectangular" 
             data-theme="outline" 
             data-text="signin_with" 
             data-size="large" 
             data-logo_alignment="left">
        </div>
    </div>
</div>

<div id="home" class="view active">
    <div class="section-box">
        <h3 style="margin-top:0">What's Happening?</h3>
        <p style="color:#aaa; font-size: 14px;">Welcome to G-Blocks! Start a new project to see it here.</p>
    </div>
    <h3>Trending Projects</h3>
    <div class="grid" id="trending-grid"></div>
</div>

<div id="explore" class="view">
    <h3>Explore Projects</h3>
    <div class="grid" id="explore-grid"></div>
</div>

<div id="ideas" class="view">
    <h3>Project Ideas</h3>
    <div class="grid">
        <div class="card"><div class="thumb">Tutorial</div><div class="info">Make it Fly</div></div>
        <div class="card"><div class="thumb">Tutorial</div><div class="info">Chase Game</div></div>
    </div>
</div>

<div id="editor" class="view">
    <div id="blocklyDiv"></div>
    <div class="stage-area">
        <div id="stage"></div>
        <div style="margin-top:15px; background:var(--g-panel); padding:15px; border-radius:8px;">
            <b style="font-size:14px;">Backpack</b>
            <p style="font-size:12px; color:#888;">Sign in to save sprites here</p>
        </div>
    </div>
</div>

<script>
    // VIEW CONTROLLER
    function setView(id) {
        document.querySelectorAll('.view').forEach(v => {
            v.classList.remove('active');
            v.style.display = 'none';
        });
        const active = document.getElementById(id);
        active.classList.add('active');
        active.style.display = (id === 'editor') ? 'flex' : 'block';
        if(id === 'editor') setTimeout(() => Blockly.svgResize(ws), 100);
    }

    // MODAL CONTROL
    function showLogin() { 
        document.getElementById('loginModal').style.display = 'block'; 
        document.getElementById('modalOverlay').style.display = 'block';
    }
    function closeLogin() { 
        document.getElementById('loginModal').style.display = 'none'; 
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // GOOGLE AUTH LOGIC
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        document.getElementById('userName').innerText = "Hi, " + payload.given_name;
        document.getElementById('userName').style.color = "#4cb963";
        closeLogin();
    }

    // FILL GRIDS
    function populate(id) {
        const g = document.getElementById(id);
        for(let i=1; i<=6; i++) {
            g.innerHTML += `<div class="card"><div class="thumb">IMG</div><div class="info">Project ${i}</div></div>`;
        }
    }
    populate('trending-grid');
    populate('explore-grid');

    // BLOCKLY SETUP
    const ws = Blockly.inject('blocklyDiv', {
        toolbox: `<xml>
            <category name="Events" colour="#FFD500"><block type="event_run"></block></category>
            <category name="Motion" colour="#4C97FF"><block type="move"></block></category>
            <category name="Looks" colour="#9966FF"><block type="say"></block></category>
            <category name="Sounds" colour="#D65CD6"><block type="play"></block></category>
        </xml>`,
        theme: Blockly.Themes.Zelos
    });
</script>
</body>
</html>

