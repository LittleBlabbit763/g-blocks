<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>G-Blocks - Imagine, Program, Share</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.min.js"></script>
    
    <style>
        :root { --g-blue: #4c97ff; --g-purple: #855cd6; --bg: #1e1e1e; --panel: #2d2d2d; }
        body { margin: 0; font-family: "Helvetica Neue", Arial, sans-serif; background: var(--bg); color: white; }
        
        /* NAVBAR */
        .nav { background: var(--g-blue); height: 50px; display: flex; align-items: center; padding: 0 40px; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-btn { cursor: pointer; font-weight: bold; font-size: 14px; padding: 15px 10px; }
        .nav-btn:hover { background: rgba(0,0,0,0.1); }
        .auth-zone { margin-left: auto; display: flex; align-items: center; gap: 15px; }

        /* VIEWS */
        .view { display: none; padding: 20px 40px; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; }

        /* SCRATCH-STYLE GRIDS */
        .section-box { background: var(--panel); border-radius: 8px; padding: 20px; margin-bottom: 25px; border: 1px solid #444; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .project-card { background: #3d3d3d; border-radius: 6px; overflow: hidden; border: 1px solid #555; transition: 0.2s; cursor: pointer; }
        .project-card:hover { transform: translateY(-5px); border-color: var(--g-blue); }
        .thumb { height: 130px; background: #222; display: flex; align-items: center; justify-content: center; color: #555; }
        .info { padding: 10px; font-size: 13px; }

        /* LOGIN MODAL */
        #loginModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      background: white; padding: 30px; border-radius: 12px; z-index: 1000; width: 350px; text-align: center; color: #333; }
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; }
        
        /* EDITOR */
        #editor-view { height: calc(100vh - 50px); max-width: 100%; padding: 0; display: none; }
        #editor-view.active { display: flex; }
        #blocklyDiv { flex: 1; height: 100%; }
        .stage-area { width: 480px; background: #252525; padding: 10px; border-left: 1px solid #444; }
        #stage { width: 460px; height: 345px; background: white; position: relative; }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-btn" style="font-size: 18px;" onclick="setView('home')">G-BLOCKS</div>
    <div class="nav-btn" onclick="setView('editor')">Create</div>
    <div class="nav-btn" onclick="setView('explore')">Explore</div>
    <div class="nav-btn" onclick="setView('ideas')">Ideas</div>
    <div class="auth-zone">
        <span id="userName" style="font-size: 14px;">Sign in</span>
        <button onclick="showLogin()" style="background:white; color:var(--g-blue); border:none; padding:6px 18px; border-radius:4px; font-weight:bold; cursor:pointer;">Join</button>
    </div>
</div>

<div id="modalOverlay" onclick="closeLogin()"></div>
<div id="loginModal">
    <h2 style="margin-top:0">Sign in to G-Blocks</h2>
    <input type="text" placeholder="Username" style="width:90%; padding:10px; margin-bottom:10px; border:1px solid #ddd;">
    <input type="password" placeholder="Password" style="width:90%; padding:10px; margin-bottom:20px; border:1px solid #ddd;">
    <button style="width:100%; background:var(--g-blue); color:white; border:none; padding:12px; border-radius:4px; font-weight:bold; cursor:pointer">Login</button>
    
    <div style="margin: 20px 0; color: #777; font-size: 14px;">Or sign in with Google</div>
    
<div id="g_id_onload"
     data-client_id="http://127.0.0.1:5500"
     data-context="signin"
     data-ux_mode="redirect" 
     data-login_uri="http://127.0.0.1:5500"
     data-auto_prompt="false">
</div>
    <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
</div>

<div id="home" class="view active">
    <div class="section-box">
        <h3>What's Happening?</h3>
        <p style="color:#aaa; font-size: 14px;">tamagotchi_from1997 loved "WE WON!!!" • 19m ago</p>
        <p style="color:#aaa; font-size: 14px;">gleb_112233 remixed "Tkisarus" • 1h ago</p>
    </div>
    <h3>Trending Projects</h3>
    <div class="grid" id="trending-grid"></div>
</div>

<div id="explore" class="view">
    <div style="display:flex; justify-content:space-between; align-items:center">
        <h3>Explore Projects</h3>
        <div style="display:flex; gap:10px;">
            <button style="background:#444; color:white; border:none; padding:5px 15px; border-radius:20px;">Animations</button>
            <button style="background:#444; color:white; border:none; padding:5px 15px; border-radius:20px;">Games</button>
        </div>
    </div>
    <hr style="border:0; border-top:1px solid #444; margin: 20px 0;">
    <div class="grid" id="explore-grid"></div>
</div>

<div id="ideas" class="view">
    <div class="section-box">
        <h3>Choose a Tutorial</h3>
        <div class="grid">
            <div class="project-card"><div class="thumb">Getting Started</div></div>
            <div class="project-card"><div class="thumb">Make it Fly</div></div>
            <div class="project-card"><div class="thumb">Animate a Name</div></div>
        </div>
    </div>
</div>

<div id="editor" class="view">
    <div class="editor-container" style="display:flex; height:100%; width:100%;">
        <div id="blocklyDiv"></div>
        <div class="stage-area">
            <div id="stage"></div>
            <div style="margin-top:10px; background:#333; padding:15px; border-radius:8px;">
                <b style="font-size:14px;">Backpack</b>
                <p style="font-size:12px; color:#888;">Drag sprites here to save them</p>
            </div>
        </div>
    </div>
</div>

<script>
    // VIEW NAVIGATION
    function setView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'editor') {
            document.getElementById('editor').style.display = 'flex';
            setTimeout(() => Blockly.svgResize(ws), 100);
        } else {
            document.getElementById('editor').style.display = 'none';
        }
    }

    // LOGIN UI
    function showLogin() { 
        document.getElementById('loginModal').style.display = 'block'; 
        document.getElementById('modalOverlay').style.display = 'block';
    }
    function closeLogin() { 
        document.getElementById('loginModal').style.display = 'none'; 
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // 3. FIXED: Google Auth Logic
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        console.log("Welcome, " + payload.name);
        document.getElementById('userName').innerText = payload.given_name;
        document.getElementById('userName').style.color = "#4cb963";
        closeLogin();
    }

    // GRID POPULATION
    function populate(id, count) {
        const g = document.getElementById(id);
        const titles = ["Platformer", "Cloud Chat", "3D Engine", "Art Maker", "Music Sim", "Quest"];
        for(let i=0; i<count; i++) {
            g.innerHTML += `
                <div class="project-card">
                    <div class="thumb">IMAGE</div>
                    <div class="info">
                        <div style="color:var(--g-blue)">${titles[i % 6]}</div>
                        <div style="font-size:11px; color:#aaa; margin-top:4px;">by user_${Math.floor(Math.random()*999)}</div>
                    </div>
                </div>`;
        }
    }
    populate('trending-grid', 5);
    populate('explore-grid', 10);

    // BLOCKLY SETUP
    const ws = Blockly.inject('blocklyDiv', {
        toolbox: `<xml>
            <category name="Events" colour="#FFD500"><block type="event_run"></block></category>
            <category name="Motion" colour="#4C97FF"><block type="move"></block></category>
            <category name="Looks" colour="#9966FF"><block type="say"></block></category>
            <category name="Sounds" colour="#D65CD6"><block type="play"></block></category>
        </xml>`,
        theme: Blockly.Themes.Zelos
    });
</script>
</body>
</html>
