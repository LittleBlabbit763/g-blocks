<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Blocks - Create & Share</title>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.min.js"></script>
    
    <style>
        :root { --g-blue: #4c97ff; --g-dark: #1e1e1e; --g-panel: #2d2d2d; }
        body { margin: 0; font-family: "Helvetica Neue", Arial, sans-serif; background: var(--g-dark); color: white; overflow: hidden; }
        
        /* NAVBAR */
        .nav { background: var(--g-blue); height: 50px; display: flex; align-items: center; padding: 0 40px; gap: 20px; z-index: 100; position: relative; }
        .nav-btn { cursor: pointer; font-weight: bold; font-size: 14px; padding: 15px 10px; }
        .nav-btn:hover { background: rgba(0,0,0,0.1); }
        .auth-zone { margin-left: auto; display: flex; align-items: center; gap: 15px; }

        /* VIEWS */
        .view { display: none; height: calc(100vh - 50px); width: 100%; }
        .view.active { display: block; }

        /* EDITOR LAYOUT */
        #editor-container { display: flex; height: 100%; width: 100%; }
        #blocklyDiv { flex: 1; height: 100%; }
        .stage-area { width: 480px; background: #252525; padding: 10px; border-left: 1px solid #444; position: relative; }
        #stage { width: 460px; height: 345px; background: white; border-radius: 4px; }

        /* BACKPACK HOVER TAB */
        .backpack-tab {
            position: absolute; bottom: 0; left: 10px; right: 10px;
            background: #333; height: 40px; border-radius: 8px 8px 0 0;
            transition: height 0.3s ease; overflow: hidden; border: 1px solid #555;
            cursor: pointer; z-index: 10;
        }
        .backpack-tab:hover { height: 150px; }
        .backpack-header { padding: 10px; font-weight: bold; font-size: 14px; background: #444; text-align: center; }
        .backpack-content { padding: 20px; text-align: center; color: #888; font-size: 12px; }

        /* LOGIN MODAL */
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; }
        #loginModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      background: white; padding: 30px; border-radius: 12px; z-index: 1000; width: 320px; text-align: center; color: #333; }
        .login-input { width: 90%; padding: 10px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; }
        
        /* CONTENT PAGES */
        .content-view { padding: 40px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: var(--g-panel); border-radius: 8px; border: 1px solid #444; height: 150px; }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-btn" style="font-size: 18px;" onclick="setView('home')">G-BLOCKS</div>
    <div class="nav-btn" onclick="setView('editor')">Create</div>
    <div class="nav-btn" onclick="setView('explore')">Explore</div>
    <div class="nav-btn" onclick="setView('ideas')">Ideas</div>
    <div class="auth-zone">
        <span id="userName" style="font-size: 13px;">Guest</span>
        <button onclick="showLogin()" style="background:white; color:var(--g-blue); border:none; padding:6px 16px; border-radius:4px; font-weight:bold; cursor:pointer;">Sign In</button>
    </div>
</div>

<div id="modalOverlay" onclick="closeLogin()"></div>
<div id="loginModal">
    <h2 style="margin: 0 0 20px 0">Sign in</h2>
    <input type="text" class="login-input" placeholder="Username">
    <input type="password" class="login-input" placeholder="Password">
    <button style="width:97%; background:var(--g-blue); color:white; border:none; padding:12px; border-radius:4px; font-weight:bold; cursor:pointer">Login</button>
    
    <div style="margin: 20px 0; color: #777; font-size: 12px; font-weight: bold;">OR</div>

    <div id="g_id_onload"
         data-client_id="258808178099-fm3pc7dvf10.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div style="display: flex; justify-content: center;">
        <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline" data-text="signin_with" data-size="large"></div>
    </div>
</div>

<div id="home" class="view content-view active">
    <h3>What's Happening?</h3>
    <div style="background:var(--g-panel); padding:20px; border-radius:8px; color:#aaa;">No recent activity.</div>
</div>

<div id="explore" class="view content-view">
    <h3>Trending Projects</h3>
    <div class="grid" id="explore-grid"></div>
</div>

<div id="ideas" class="view content-view">
    <h3>Tutorials</h3>
    <div class="grid">
        <div class="card" style="padding:15px">Make a Chase Game</div>
        <div class="card" style="padding:15px">Animate a Character</div>
    </div>
</div>

<div id="editor" class="view">
    <div id="editor-container">
        <div id="blocklyDiv"></div>
        <div class="stage-area">
            <div id="stage"></div>
            
            <div class="backpack-tab">
                <div class="backpack-header">Backpack</div>
                <div class="backpack-content">
                    Drag code blocks or sprites here to save them for later!
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // VIEW CONTROLLER
    function setView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const active = document.getElementById(id);
        active.classList.add('active');
        if(id === 'editor') {
            active.style.display = 'flex';
            setTimeout(() => { Blockly.svgResize(workspace); }, 50);
        } else {
            active.style.display = 'block';
        }
    }

    // MODAL
    function showLogin() { 
        document.getElementById('loginModal').style.display = 'block'; 
        document.getElementById('modalOverlay').style.display = 'block';
    }
    function closeLogin() { 
        document.getElementById('loginModal').style.display = 'none'; 
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // GOOGLE LOGIN
    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        document.getElementById('userName').innerText = "Hi, " + payload.given_name;
        document.getElementById('userName').style.color = "#4cb963";
        closeLogin();
    }

    // BLOCKLY INITIALIZATION (RESTORED)
    const toolbox = {
        "kind": "categoryToolbox",
        "contents": [
            {"kind": "category", "name": "Events", "colour": "#FFD500", "contents": [{"kind": "block", "type": "event_whenflagclicked"}]},
            {"kind": "category", "name": "Motion", "colour": "#4C97FF", "contents": [{"kind": "block", "type": "motion_movesteps"}]},
            {"kind": "category", "name": "Control", "colour": "#FFAB19", "contents": [{"kind": "block", "type": "controls_repeat"}]},
            {"kind": "category", "name": "Sensing", "colour": "#4CBFE6", "contents": []},
            {"kind": "category", "name": "Logic", "colour": "#59C059", "contents": [{"kind": "block", "type": "logic_compare"}]}
        ]
    };

    // Define dummy blocks for Scratch look
    Blockly.Blocks['event_whenflagclicked'] = { init: function() { this.appendDummyInput().appendField("when green flag clicked"); this.setNextStatement(true); this.setColour("#FFD500"); } };
    Blockly.Blocks['motion_movesteps'] = { init: function() { this.appendDummyInput().appendField("move").appendField(new Blockly.FieldTextInput("10"), "STEPS").appendField("steps"); this.setPreviousStatement(true); this.setNextStatement(true); this.setColour("#4C97FF"); } };

    const workspace = Blockly.inject('blocklyDiv', {
        toolbox: toolbox,
        theme: Blockly.Themes.Zelos,
        grid: {spacing: 20, length: 3, colour: '#333', snap: true},
        zoom: {controls: true, wheel: true}
    });

    // Populate Explore
    const exGrid = document.getElementById('explore-grid');
    for(let i=0; i<6; i++) { exGrid.innerHTML += `<div class="card"></div>`; }
</script>
</body>
</html>
